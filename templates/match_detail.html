{% extends "base.html" %}
{% load i18n %}
{% block title %}Матч {{ match.team_a }} vs {{ match.team_b }}{% endblock %}
{% block content %}
<h2>{{ match.tournament.title }} - Раунд {{ match.round }}</h2>

<table class="table table-bordered w-auto">
  <tr>
    <th>Команда A</th><th>Счёт A</th><th>Команда B</th><th>Счёт B</th>
  </tr>
  <tr>
    <td>
      <strong>{{ match.team_a }}</strong>
      <ul class="small mb-0">
        {% for p in match.team_a.members.all %}<li>{{ p.username }}</li>{% endfor %}
      </ul>
    </td>
    <td class="text-center">{{ match.score_a }}</td>
    <td>
      <strong>{{ match.team_b }}</strong>
      <ul class="small mb-0">
        {% for p in match.team_b.members.all %}<li>{{ p.username }}</li>{% endfor %}
      </ul>
    </td>
    <td class="text-center">{{ match.score_b }}</td>
  </tr>
</table>

<!-- Add button to open modal -->
<button type="button" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#submitScoreModal">
  Отправить счёт
</button>

<!-- Modal structure -->
<div class="modal fade" id="submitScoreModal" tabindex="-1" aria-labelledby="submitScoreModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="submitScoreModalLabel">Отправить счёт</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'submit_score' match.id %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="scoreA" class="form-label">Счёт команды A</label>
            <input type="number" class="form-control" id="scoreA" name="score_a" required>
          </div>
          <div class="mb-3">
            <label for="scoreB" class="form-label">Счёт команды B</label>
            <input type="number" class="form-control" id="scoreB" name="score_b" required>
          </div>
          <button type="submit" class="btn btn-primary">Отправить</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% if disputes %}
  <h4 class="mt-4">Споры ({{ disputes.count }})</h4>
  {% for d in disputes %}
    <div class="card mb-3">
      <div class="card-header">
        От {{ d.raised_by.username }} {% if d.resolved %}<span class="badge bg-success">решён</span>{% endif %}
      </div>
      <div class="card-body">
        <p class="card-text">{{ d.description }}</p>
        {% if d.attachments.all %}
          <p class="mb-1"><strong>Файлы:</strong></p>
          <ul class="small">
            {% for a in d.attachments.all %}
              <li><a href="{{ a.file.url }}" target="_blank">{{ a.file.name }}</a></li>
            {% endfor %}
          </ul>
        {% endif %}
        {% if d.resolved %}
          <p class="small text-muted">Решил: {{ d.resolved_by }} - {{ d.resolution_notes }}</p>
        {% endif %}
      </div>
    </div>
  {% endfor %}
{% endif %}

<a href="javascript:history.back()" class="btn btn-link">← Назад</a>
{% endblock %}
